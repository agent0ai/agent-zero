# Code Style and Conventions

## Python
- **Python version**: 3.12+ (managed by mise)
- **Type hints**: `str | None` style preferred over `Optional[str]`
- **Naming**: snake_case for functions/variables, PascalCase for classes
- **Imports**: Standard lib first, then third-party, then local modules
- **Dataclasses**: Used for configuration objects (e.g., `AgentConfig`, `ModelConfig`)
- **Async**: Heavy use of `asyncio` and `nest_asyncio`; many API handlers are async
- **Docstrings**: Minimal; code is expected to be self-documenting

## Linting & Formatting (Enforced)
- **Ruff**: Python linting and formatting (configured in `pyproject.toml`)
- **Biome**: CSS/JS linting (configured in `biome.json`)
- **Pre-commit hooks**: Enforced via `hk` (configured in `hk.pkl`):
  - Ruff lint + format check
  - Biome CSS lint
  - Security checks (no secrets, no .env commits)
  - File hygiene (trailing whitespace, EOF newlines)
- **Commit messages**: Conventional Commits format (enforced by hk commit-msg hook)
  - Format: `type(scope): description` (e.g., `feat: Add new tool`, `fix: Resolve memory leak`)
  - Types: feat, fix, refactor, chore, docs, test, ci, style, perf

## JavaScript (WebUI)
- Vanilla JS with Alpine.js (reactive data binding)
- HTML templates with Alpine.js directives
- Socket.IO for real-time communication
- Standard browser APIs

## Project Conventions
- Tools: Python classes in `python/tools/`, auto-discovered; extend `Tool`, implement `async execute(**kwargs) -> Response`
- API handlers: Classes extending `ApiHandler` in `python/api/`, auto-discovered; implement `async process(input, request) -> dict`
- WebSocket handlers: In `python/websocket_handlers/`, namespace-based discovery
- Extensions: Organized by lifecycle event in `python/extensions/` subdirectories; extend `Extension`, implement `async execute(**kwargs)`, sorted by filename prefix (`_10_`, `_20_`, etc.)
- Prompts: Markdown files in `prompts/`, using `{{ include }}` and `{{variable}}` syntax
- Disabled files: `._py` suffix indicates disabled/archived
- Settings: JSON-based system (`python/helpers/settings.py`)

## Dependency Management
- **Source of truth**: `pyproject.toml` (managed by uv)
- **Lockfile**: `uv.lock` (committed)
- **Docker compat**: `requirements.txt` (auto-generated by `uv export`, DO NOT edit manually)
- **Override**: `[tool.uv] override-dependencies` for version conflicts (e.g., openai)
- **Add dep workflow**: `mise run deps:add <pkg>` or `uv add <pkg>` then regenerate requirements.txt
