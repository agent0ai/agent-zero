# Agent Zero Live Artifact Canvas

A Claude/Gemini-style live artifact canvas implementation for Agent Zero that displays artifacts created by the agent in real-time.

## Overview

The Artifact Canvas is a sliding panel that appears on the right side of the Agent Zero interface, providing real-time visualization and interaction with content generated by the AI agent. It supports syntax highlighting, live preview, and seamless integration with the chat interface.

## Features

### Core Functionality
- **Real-time Streaming**: Artifacts appear and update live as the agent creates them
- **Sliding Panel**: Non-intrusive design that slides out from the right side
- **Syntax Highlighting**: Pretty code colors using Prism.js for various languages
- **Live Preview**: Execute and display HTML, SVG, and other interactive content
- **Chat Integration**: Artifacts are linked to specific chat conversations
- **File Organization**: Artifacts are organized by chat ID in separate directories

### User Interface
- **Tabbed Interface**: Preview, Code, and Info tabs for different views
- **Download/Share**: Export artifacts as files or copy content
- **Fullscreen Mode**: Expand artifacts for detailed viewing
- **Dark/Light Theme**: Automatic theme adaptation
- **Responsive Design**: Works on desktop and mobile devices

### Supported Artifact Types
- HTML documents and web pages
- SVG graphics and illustrations
- JavaScript code and applications
- Python scripts and data analysis
- CSS stylesheets
- JSON data structures
- Markdown documentation
- Images (base64 encoded)

## Architecture

### Frontend Components

#### ArtifactCanvas Class (`/webui/js/artifact_canvas.js`)
Main class handling the canvas functionality:
```javascript
class ArtifactCanvas {
    constructor() {
        this.socket = null;
        this.currentChatId = null;
        this.artifacts = new Map();
        this.isVisible = false;
    }
    
    // Core methods
    toggleCanvas()
    setChatId(chatId)
    createArtifact(artifact)
    updateArtifact(artifact)
    // ...
}
```

#### Key Features:
- WebSocket integration using Socket.IO
- Real-time artifact management
- UI state management
- Event handling for user interactions

#### CSS Styling (`/webui/css/artifact_canvas.css`)
Complete styling with:
- Smooth slide animations
- Modern card-based design
- Responsive layouts
- Theme support (dark/light)
- Syntax highlighting integration

### Backend Components

#### Artifact Handler API (`/python/api/artifacts.py`)
Core backend service providing:
```python
class ArtifactHandler(ApiHandler):
    def process(self, input: dict, request: Request) -> Union[dict, Response]:
        # CRUD operations for artifacts
        
    def create_artifact(self, input: dict) -> dict:
        # Create new artifacts with metadata
        
    def start_watching(self, chat_id: str, websocket_handler=None):
        # File system watching for real-time updates
```

#### Key Capabilities:
- Full CRUD operations (Create, Read, Update, Delete)
- File system watching with `watchdog`
- WebSocket event emission
- Chat-specific artifact organization
- Metadata management

#### WebSocket Integration (`run_ui.py`)
Flask-SocketIO setup with event handlers:
```python
@socketio.on('connect', namespace='/artifacts')
def handle_artifact_connect():
    # Client connection handling

@socketio.on('subscribe', namespace='/artifacts') 
def handle_artifact_subscribe(data):
    # Subscribe to chat-specific artifacts
```

#### Code Execution Integration (`/python/tools/code_execution_tool.py`)
Automatic artifact detection and creation:
```python
async def check_and_create_artifact(self, output: str, session: int):
    # Detect HTML, SVG, images in agent output
    # Automatically create artifacts
```

## Installation & Setup

### Dependencies
The artifact canvas requires these Python packages:
```
flask-socketio==5.4.1
watchdog==6.0.0
```

### Frontend Libraries
- Socket.IO client for WebSocket communication
- Prism.js for syntax highlighting

### File Structure
```
webui/
â”œâ”€â”€ js/
â”‚   â””â”€â”€ artifact_canvas.js      # Main canvas implementation
â”œâ”€â”€ css/
â”‚   â””â”€â”€ artifact_canvas.css     # Styling and animations
â””â”€â”€ index.html                  # Updated with canvas button

python/
â”œâ”€â”€ api/
â”‚   â””â”€â”€ artifacts.py            # Backend API handler
â””â”€â”€ tools/
    â””â”€â”€ code_execution_tool.py  # Auto artifact detection

artifacts/                      # Generated artifact storage
â”œâ”€â”€ chat_id_1/
â”‚   â”œâ”€â”€ metadata.json          # Artifact metadata
â”‚   â”œâ”€â”€ artifact1.html         # HTML artifacts
â”‚   â””â”€â”€ artifact2.svg          # SVG artifacts
â””â”€â”€ chat_id_2/
    â””â”€â”€ ...
```

## Usage

### Basic Operation

1. **Opening the Canvas**: Click the canvas button (ðŸ“‹) next to the nudge button
2. **Chat Integration**: Artifacts automatically filter by the current chat
3. **Viewing Artifacts**: Switch between Preview, Code, and Info tabs
4. **Managing Artifacts**: Download, share, or view in fullscreen

### Automatic Artifact Creation

The system automatically detects and creates artifacts when the agent outputs:
- HTML content with `<html>` tags or `<!DOCTYPE html>`
- SVG graphics with `<svg>` tags
- Base64 encoded images
- JavaScript code with `<script>` tags
- Canvas elements

### Manual Artifact Creation

Artifacts can also be created programmatically:
```python
artifact_data = {
    "chat_id": "current_chat_id",
    "artifact_id": "unique_identifier", 
    "type": "html",
    "content": "<html>...</html>",
    "metadata": {
        "title": "My Artifact",
        "description": "A sample HTML page"
    }
}

result = artifact_handler.create_artifact(artifact_data)
```

## WebSocket Events

### Client â†’ Server
- `connect`: Join the artifacts namespace
- `subscribe`: Subscribe to a specific chat's artifacts
- `unsubscribe`: Unsubscribe from artifact updates
- `create_artifact`: Manually create an artifact

### Server â†’ Client  
- `connected`: Connection confirmation
- `artifacts_list`: Current artifacts for a chat
- `artifact_update`: Real-time artifact updates

## API Endpoints

### REST API (via ApiHandler)
- `POST /api/artifacts` - Create new artifact
- `GET /api/artifacts?chat_id=X` - List artifacts for chat
- `GET /api/artifacts?chat_id=X&artifact_id=Y` - Get specific artifact
- `DELETE /api/artifacts?chat_id=X&artifact_id=Y` - Delete artifact

## Configuration

### Environment Variables
- `ARTIFACTS_DIR`: Base directory for artifact storage (default: `./artifacts`)
- `MAX_ARTIFACT_SIZE`: Maximum artifact content size (default: 10MB)

### Agent Configuration
```python
# Enable artifact detection in code execution
ENABLE_ARTIFACT_DETECTION = True

# Supported artifact patterns
ARTIFACT_PATTERNS = [
    r'<html[^>]*>.*</html>',
    r'<svg[^>]*>.*</svg>',
    r'<!DOCTYPE html>',
    # ...
]
```

## Development

### Adding New Artifact Types

1. **Update Detection Patterns** in `code_execution_tool.py`:
```python
def is_artifact_content(self, content: str) -> bool:
    artifact_patterns = [
        # Add new pattern here
        r'your_new_pattern',
    ]
```

2. **Add File Extension Mapping** in `artifacts.py`:
```python
extensions = {
    "new_type": ".new_ext",
    # ...
}
```

3. **Update Frontend Rendering** in `artifact_canvas.js`:
```javascript
renderPreview(artifact) {
    switch(artifact.type) {
        case 'new_type':
            return this.renderNewType(artifact);
        // ...
    }
}
```

### Testing

#### Unit Tests
```bash
cd /Users/johnmbwambo/agent-zero
python -m pytest tests/test_artifacts.py
```

#### Integration Tests
```bash
# Start the server
python run_ui.py

# Test WebSocket connections
node tests/test_websocket.js

# Test artifact creation
python tests/test_artifact_creation.py
```

## Troubleshooting

### Common Issues

#### Canvas Not Appearing
- Check browser console for JavaScript errors
- Verify Socket.IO connection in Network tab
- Ensure Flask-SocketIO is installed and running

#### Artifacts Not Creating
- Check agent output contains detectable patterns
- Verify file permissions in artifacts directory
- Check server logs for artifact handler errors

#### WebSocket Connection Failed
- Confirm CORS settings in Flask-SocketIO
- Check firewall settings for WebSocket traffic
- Verify namespace configuration (`/artifacts`)

#### Styling Issues
- Clear browser cache
- Check CSS file loading in Developer Tools
- Verify theme CSS variables are defined

### Debug Mode
Enable debug logging:
```python
# In run_ui.py
socketio = SocketIO(webapp, cors_allowed_origins="*", logger=True, engineio_logger=True)
```

## Performance Considerations

### File Watching
- File watching is per-chat to reduce overhead
- Observers are cleaned up when chats are closed
- Metadata caching prevents excessive file reads

### WebSocket Scaling
- Uses threading mode for Flask-SocketIO
- Namespace isolation prevents cross-chat interference
- Automatic reconnection on connection loss

### Frontend Optimization
- Lazy loading of syntax highlighting
- Virtual scrolling for large artifact lists
- Debounced search and filtering

## Security

### Input Validation
- All artifact content is sanitized before storage
- File paths are validated to prevent directory traversal
- Maximum content size limits prevent DoS attacks

### Sandbox Execution
- Preview content runs in sandboxed iframes
- CSP headers prevent malicious script execution
- User confirmation required for external links

## Future Enhancements

### Planned Features
- [ ] Collaborative editing of artifacts
- [ ] Version history and diff visualization
- [ ] Export to various formats (PDF, PNG, etc.)
- [ ] Integration with external editors
- [ ] Artifact search and tagging
- [ ] Performance analytics dashboard

### Extension Points
- Plugin system for custom artifact types
- Webhook integration for external services
- Custom preview renderers
- Third-party syntax highlighter support

## Contributing

### Code Style
- Follow existing patterns in codebase
- Use TypeScript-style JSDoc comments
- Maintain backwards compatibility

### Pull Request Process
1. Fork the repository
2. Create feature branch: `git checkout -b feature/artifact-enhancement`
3. Implement changes with tests
4. Update documentation
5. Submit pull request with detailed description

### Testing Requirements
- Unit tests for new functionality
- Integration tests for WebSocket features
- Browser compatibility testing
- Performance benchmarking for large artifacts

---

## License

This artifact canvas implementation is part of Agent Zero and follows the same license terms.
