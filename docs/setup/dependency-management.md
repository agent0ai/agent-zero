# Dependency Management

Agent Zero uses [uv](https://docs.astral.sh/uv/) for dependency management with `pyproject.toml` as the single source of truth.

## File Roles

| File | Role | Edit manually? |
|------|------|----------------|
| `pyproject.toml` | All dependencies, project metadata, tool config | Yes |
| `uv.lock` | Reproducible lockfile (committed) | No — generated by `uv lock` |
| `requirements.txt` | Flat pin file for Docker `uv pip install` | No — generated by `uv export` |
| `.python-version` | Python version for uv and mise | Rarely |

## Ongoing Workflow

### Add a new dependency

```bash
uv add <package>            # adds to pyproject.toml + re-locks
uv export --no-hashes --no-dev --no-emit-project -o requirements.txt
```

### Add a dev-only dependency

```bash
uv add --group dev <package>
```

### Remove a dependency

```bash
uv remove <package>
uv export --no-hashes --no-dev --no-emit-project -o requirements.txt
```

### Update a dependency version

Edit the version in `pyproject.toml`, then:

```bash
uv lock
uv export --no-hashes --no-dev --no-emit-project -o requirements.txt
```

### Install locally (after cloning or pulling)

```bash
uv sync              # production deps
uv sync --group dev  # include test/dev deps
```

### Run tests

```bash
uv run pytest tests/ -v
```

## Override Dependencies

`browser-use==0.5.11` pins `openai==1.99.2` transitively, but `litellm` needs `>=1.99.5`. Rather than a two-file install hack, we use uv's override mechanism in `pyproject.toml`:

```toml
[tool.uv]
override-dependencies = ["openai==1.99.5"]
```

This tells uv to ignore any transitive pin on `openai` and resolve to exactly `1.99.5`.

## Docker Compatibility

Docker images use `uv pip install -r requirements.txt` (see `docker/run/fs/ins/install_A0.sh`). Since `requirements.txt` is generated from the lockfile with all transitive deps fully pinned, Docker builds are reproducible and don't need `pyproject.toml` or `uv.lock`.

## Upstream Merge Strategy

This repo is a fork of [agent0ai/agent-zero](https://github.com/agent0ai/agent-zero), maintained at [jrmatherly/agent-zero](https://github.com/jrmatherly/agent-zero). The upstream project still uses a plain `requirements.txt`. When merging upstream changes:

1. **Accept their `requirements.txt` changes** — let git take upstream's version (it will be overwritten).
2. **Update `pyproject.toml`** — add any new packages or version changes from their `requirements.txt` into the `[project] dependencies` list.
3. **Re-lock and re-export**:

```bash
uv lock
uv export --no-hashes --no-dev --no-emit-project -o requirements.txt
```

4. **Verify** — check that new packages resolved correctly:

```bash
uv run python -c "import <new_package>; print('ok')"
uv run pytest tests/ -v
```

This keeps our fork's `pyproject.toml` as the source of truth while staying compatible with upstream's dependency additions.
